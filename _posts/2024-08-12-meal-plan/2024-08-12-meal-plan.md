---
layout: post
title: Meal Plan test
---

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="meal-plan.css">
</head>

<div class="meal-plan" id="meal-plan"></div>
<div id="overlay" class="overlay"></div>
<div id="popup" class="popup">
    <span id="popup-close" class="popup-close">&times;</span>
    <div id="popup-content"></div>
</div>

<script>
    const days = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
    const meals = ["morning", "midday", "evening"];
    const versions = ["1", "2", "3"];
    const data = {};

    async function fetchCSV(url) {
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error(`Could not fetch ${url}, received ${response.status}`);
        }
        const text = await response.text();
        const lines = text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
        
        const parseCSVLine = (line) => {
            let result = [];
            let currentField = '';
            let inQuotes = false;
            for (let i = 0; i < line.length; i++) {
                let c = line[i];
                if (c === '"' && line[i - 1] !== '\\') {
                    // Start or end of quoted field
                    inQuotes = !inQuotes;
                } else if (c === ',' && !inQuotes) {
                    // End of non-quoted field
                    result.push(currentField);
                    currentField = '';
                } else {
                    currentField += c;
                }
            }
            result.push(currentField);
            return result.map(field => 
                field.replace(/^"|"$/g, '').replace(/\\"/g, '"').trim() // Remove surrounding quotes and unescape inner quotes
            );
        };

        const headers = parseCSVLine(lines[0]);
        return lines.slice(1).map(line => {
            const columns = parseCSVLine(line);
            return headers.reduce((obj, header, index) => {
                obj[header] = columns[index] || undefined;
                return obj;
            }, {});
        });
    }

    async function renderMealPlan() {
        const mealPlanContainer = document.getElementById('meal-plan');
        const popup = document.getElementById('popup');
        const popupContent = document.getElementById('popup-content');
        const popupClose = document.getElementById('popup-close');
        const overlay = document.getElementById('overlay');

        // Using DocumentFragment for efficient DOM manipulation
        const fragment = document.createDocumentFragment();

        // Loop through each day in the correct order
        for (const day of days) {
            // Ensure data for the day exists before proceeding
            if (data[day]) { 
                const dayDiv = document.createElement('div');
                dayDiv.classList.add('day');
                const dayTitle = document.createElement('h2');
                dayTitle.textContent = day.charAt(0).toUpperCase() + day.slice(1); // Capitalize day name
                dayDiv.appendChild(dayTitle);

                // Loop through meals for the current day
                for (const meal of meals) { 
                    if (data[day][meal]){
                    const mealDiv = document.createElement('div');
                    mealDiv.classList.add('schedule');
                    const mealTitle = document.createElement('h3');
                    mealTitle.textContent = meal.charAt(0).toUpperCase() + meal.slice(1); // Capitalize meal name
                    mealDiv.appendChild(mealTitle);

                    const mealsDiv = document.createElement('div');
                    mealsDiv.classList.add('meals');

                    // Loop through versions for the current meal
                    for (const version of Object.keys(data[day][meal])) { // Use Object.keys to iterate over versions
                        const versionDiv = document.createElement('div');
                        versionDiv.classList.add('meal');

                        // Set the title and add event listener for popup
                        const mealData = data[day][meal][version];
                        versionDiv.textContent = mealData.title; // Use title from the first line
                        versionDiv.addEventListener('click', () => {
                            popupContent.innerHTML = `<h2>${mealData.title}</h2><p>${mealData.content}</p>`;
                            popup.style.display = 'block';
                            overlay.style.display = 'block';
                        });
                        mealsDiv.appendChild(versionDiv);
                    }

                    mealDiv.appendChild(mealsDiv);
                    dayDiv.appendChild(mealDiv);
                }

                fragment.appendChild(dayDiv);
                }
                }
        }

    mealPlanContainer.appendChild(fragment);

    // Popup close functionality
    popupClose.addEventListener('click', () => {
        popup.style.display = 'none';
        overlay.style.display = 'none';
    });

    overlay.addEventListener('click', () => {
        popup.style.display = 'none';
        overlay.style.display = 'none';
    });
}


    fetchData().then(() => {
        renderMealPlan().then(() => {
            console.log(data);
            console.log("Meal plan rendered successfully.");
        });
    });
</script>
